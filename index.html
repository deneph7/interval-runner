<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¸í„°ë²Œ ëŸ¬ë„ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
  <style>
    body {
      font-family: -apple-system, sans-serif;
      background: linear-gradient(to right, #667eea, #764ba2);
      margin: 0; padding: 20px;
      color: white;
    }
    .container { max-width: 600px; margin: 0 auto; text-align: center; }
    h1 { margin-bottom: 10px; }
    #lottie { width: 280px; height: 280px; margin: 0 auto 20px; background: rgba(255,255,255,0.08); border-radius: 20px; }
    .phase { font-size: 20px; margin-bottom: 6px; }
    .timer { font-size: 36px; font-weight: bold; margin-bottom: 15px; }
    .info-row { display: flex; justify-content: space-around; margin-bottom: 20px; }
    .info-box { text-align: center; }
    .info-box span { display: block; font-size: 20px; }
    .progress-bar {
      height: 10px;
      background: rgba(255,255,255,0.3);
      border-radius: 5px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    .fill { height: 100%; width: 0%; background: #4caf50; transition: width 0.3s ease-out; }

    .btns {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;
    }
    button {
      padding: 12px 20px;
      background: rgba(255,255,255,0.2);
      border: none; color: white;
      font-size: 16px; font-weight: bold;
      border-radius: 8px; cursor: pointer;
    }
    button:disabled { opacity: 0.5; }
    .settings { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; }

    .modal {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none; justify-content: center; align-items: center;
      z-index: 1000;
    }
    .modal.show { display: flex; }
    .modal-content {
      background: white; color: #333;
      padding: 20px; border-radius: 14px; width: 300px;
    }
    .modal-content h2 { margin-bottom: 20px; }
    .modal-content label { display: block; margin: 10px 0 5px; font-weight: bold; }
    .modal-content input {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px;
    }
    .modal-content .modal-btns {
      margin-top: 20px; display: flex; justify-content: space-between;
    }
    .modal-content button {
      flex: 1; margin: 5px;
      background: #4caf50; color: white; border: none;
    }
    .modal-content .cancel {
      background: #f44336;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="settings" onclick="openSettings()">âš™ï¸</div>
  <h1>ì¸í„°ë²Œ ëŸ¬ë„ˆ</h1>
  <div id="lottie"></div>
  <div class="phase" id="phaseText">ì¤€ë¹„</div>
  <div class="timer" id="timerText">00:00</div>

  <div class="progress-bar"><div class="fill" id="progressFill"></div></div>

  <div class="info-row">
    <div class="info-box">
      <strong>ê±·ê¸°</strong>
      <span id="walkDisplay">02:00</span>
    </div>
    <div class="info-box">
      <strong>ë›°ê¸°</strong>
      <span id="runDisplay">02:00</span>
    </div>
  </div>

  <div class="btns">
    <button onclick="start()" id="startBtn">ì‹œì‘</button>
    <button onclick="pause()" id="pauseBtn" disabled>ì¼ì‹œì •ì§€</button>
    <button onclick="stop()" id="stopBtn" disabled>ì •ì§€</button>
    <button onclick="next()" id="nextBtn" disabled>ë‹¤ìŒ</button>
  </div>
</div>

<div class="modal" id="settingsModal">
  <div class="modal-content">
    <h2>ì„¤ì •</h2>
    <label>ì „ì²´ ìš´ë™ ì‹œê°„ (ë¶„)</label>
    <input type="number" id="totalInput" value="30" min="5" max="120" />
    <label>ì›Œë°ì—… ì‹œê°„ (ë¶„)</label>
    <input type="number" id="warmupInput" value="10" />
    <label>ê±·ê¸° ì‹œê°„ (ë¶„)</label>
    <input type="number" id="walkInput" value="2" />
    <label>ë›°ê¸° ì‹œê°„ (ë¶„)</label>
    <input type="number" id="runInput" value="2" />
    <div class="modal-btns">
      <button onclick="closeSettings()" class="cancel">ì·¨ì†Œ</button>
      <button onclick="saveSettings()">ì €ì¥</button>
    </div>
  </div>
</div>

<script>
let totalSec = 1800, warmupSec = 600, walkSec = 120, runSec = 120;
let currentPhase = 'ready';
let currentCycle = 1;
let totalCycle = 5, timer = null, remaining = 0;
let isRunning = false, isPaused = false;
let animation;

const lottieBox = document.getElementById("lottie");
const urls = {
  walking: "https://assets6.lottiefiles.com/temp/lf20_mJ0BKI.json",
  running: "https://assets1.lottiefiles.com/packages/lf20_2LdLki.json"
};

function loadAnimation(type) {
  if (animation) animation.destroy();
  animation = lottie.loadAnimation({
    container: lottieBox,
    renderer: "svg",
    loop: true,
    autoplay: true,
    path: type === 'running' ? urls.running : urls.walking
  });
}

function speak(text) {
  if ('speechSynthesis' in window) {
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = 'ko-KR';
    speechSynthesis.speak(msg);
  }
}

function format(sec) {
  const m = String(Math.floor(sec / 60)).padStart(2, '0');
  const s = String(sec % 60).padStart(2, '0');
  return `${m}:${s}`;
}

function updateUI() {
  document.getElementById("timerText").textContent = format(remaining);
  document.getElementById("walkDisplay").textContent = currentPhase === 'walking' ? format(remaining) : format(walkSec);
  document.getElementById("runDisplay").textContent = currentPhase === 'running' ? format(remaining) : format(runSec);
}

function updatePhase(name, sec, animType) {
  currentPhase = name;
  remaining = sec;
  document.getElementById("phaseText").textContent = `${name} (${currentCycle}/${totalCycle})`;
  loadAnimation(animType);
  speak(`${name} ì‹œì‘`);
  updateUI();
}

function start() {
  totalCycle = Math.floor((totalSec - warmupSec) / (walkSec + runSec));
  currentCycle = 1;
  document.getElementById("startBtn").disabled = true;
  document.getElementById("pauseBtn").disabled = false;
  document.getElementById("stopBtn").disabled = false;
  document.getElementById("nextBtn").disabled = false;
  updatePhase("ì›Œë°ì—…", warmupSec, "walking");
  runTimer();
}

function runTimer() {
  timer = setInterval(() => {
    if (!isPaused && remaining > 0) {
      remaining--;
      updateUI();
      updateProgress();
    } else if (!isPaused && remaining === 0) {
      next();
    }
  }, 1000);
}

function next() {
  if (currentPhase === "ì›Œë°ì—…") {
    updatePhase("ê±·ê¸°", walkSec, "walking");
  } else if (currentPhase === "ê±·ê¸°") {
    updatePhase("ë›°ê¸°", runSec, "running");
  } else if (currentPhase === "ë›°ê¸°") {
    currentCycle++;
    if (currentCycle > totalCycle) finish();
    else updatePhase("ê±·ê¸°", walkSec, "walking");
  }
}

function updateProgress() {
  const elapsed = totalSec - getTotalRemaining();
  const percent = (elapsed / totalSec) * 100;
  document.getElementById("progressFill").style.width = `${percent}%`;
}

function getTotalRemaining() {
  return (
    (currentPhase === "ì›Œë°ì—…" ? 0 : warmupSec) +
    (totalCycle - currentCycle + 1) * (walkSec + runSec) -
    remaining
  );
}

function pause() {
  isPaused = !isPaused;
  document.getElementById("pauseBtn").textContent = isPaused ? "ì¬ê°œ" : "ì¼ì‹œì •ì§€";
}

function stop() {
  clearInterval(timer);
  document.getElementById("startBtn").disabled = false;
  document.getElementById("pauseBtn").disabled = true;
  document.getElementById("stopBtn").disabled = true;
  document.getElementById("nextBtn").disabled = true;
  currentPhase = "ready";
  remaining = 0;
  document.getElementById("phaseText").textContent = "ì¤‘ì§€ë¨";
  document.getElementById("timerText").textContent = "00:00";
  document.getElementById("progressFill").style.width = "0%";
  updateUI();
}

function finish() {
  stop();
  document.getElementById("phaseText").textContent = "ì™„ë£Œ ğŸ‰";
  speak("ìš´ë™ ì™„ë£Œ");
}

function openSettings() {
  document.getElementById("settingsModal").classList.add("show");
  document.getElementById("totalInput").value = totalSec / 60;
  document.getElementById("warmupInput").value = warmupSec / 60;
  document.getElementById("walkInput").value = walkSec / 60;
  document.getElementById("runInput").value = runSec / 60;
}

function closeSettings() {
  document.getElementById("settingsModal").classList.remove("show");
}

function saveSettings() {
  totalSec = parseInt(document.getElementById("totalInput").value) * 60;
  warmupSec = parseInt(document.getElementById("warmupInput").value) * 60;
  walkSec = parseInt(document.getElementById("walkInput").value) * 60;
  runSec = parseInt(document.getElementById("runInput").value) * 60;
  document.getElementById("walkDisplay").textContent = format(walkSec);
  document.getElementById("runDisplay").textContent = format(runSec);
  closeSettings();
}
</script>
</body>
</html>
