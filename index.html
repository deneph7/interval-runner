<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>인터벌 러너</title>
    <style>
        body {
            font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
            margin: 0; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height: 100vh; color: #fff;
        }
        .container {max-width:600px;margin:0 auto;padding:18px;}
        .header {display:flex;justify-content:space-between;align-items:center;margin-bottom:22px;}
        .settings-btn {border:none;border-radius:15px;padding:10px 15px;font-size:24px;cursor:pointer;background:rgba(255,255,255,0.18);}
        .phase-display {text-align:center;margin-bottom:25px;}
        .current-phase {font-size:22px;font-weight:bold}
        .phase-time {font-size:40px;color:#ffd700;}
        .progress-bar {height:8px;border-radius:4px;background:rgba(255,255,255,0.18);margin:18px 0;overflow:hidden;}
        .progress-fill {background:#4CAF50;height:100%;transition:width 1s;border-radius:4px;}
        .animation-container {background:rgba(255,255,255,0.10);border-radius:22px;padding:32px 0;margin:25px 0 18px;display:flex;justify-content:center;align-items:center;min-height:320px;}
        /* Stick figure container for further transform */
        .stick-figure-outer{display:inline-block;}
        .stick-figure {width:120px;height:180px;position:relative;}
        .stick-head {width:38px;height:38px; border:4px solid #FFF;border-radius:50%;position:absolute;left:50%;top:0;transform:translateX(-50%);}
        .stick-body {position:absolute;left:50%;top:38px;width:4px;height:62px;background:#FFF;transform:translateX(-50%);}
        /* 팔 */
        .stick-arm.left,.stick-arm.right {width:60px;height:4px;background:#FFF;position:absolute;top:56px;left:50%;transform-origin:left center;}
        .stick-arm.right {transform-origin:right center;}
        /* 다리 */
        .stick-leg.left,.stick-leg.right {width:56px;height:4px;background:#FFF;position:absolute;top:100px;left:50%;transform-origin:left center;}
        .stick-leg.right {transform-origin:right center;}
        /* 걷기 애니메이션: 팔, 다리 반대방향 */
        .walking .stick-arm.left{animation:walkArmLeft 1.2s infinite;}
        .walking .stick-arm.right{animation:walkArmRight 1.2s infinite;}
        .walking .stick-leg.left{animation:walkLegLeft 1.2s infinite;}
        .walking .stick-leg.right{animation:walkLegRight 1.2s infinite;}
        /* 뛰기 애니메이션: 상하점프+큰 팔/다리 */
        .running .stick-figure-outer{animation:runJump 0.5s infinite;}
        .running .stick-arm.left{animation:runArmLeft 0.5s infinite;}
        .running .stick-arm.right{animation:runArmRight 0.5s infinite;}
        .running .stick-leg.left{animation:runLegLeft 0.5s infinite;}
        .running .stick-leg.right{animation:runLegRight 0.5s infinite;}
        /* --- Keyframes 걷기 --- */
        @keyframes walkArmLeft {
            0%{transform:rotate(25deg);}
            25%{transform:rotate(10deg);}
            50%{transform:rotate(-30deg);}
            75%{transform:rotate(8deg);}
            100%{transform:rotate(25deg);}
        }
        @keyframes walkArmRight {
            0%{transform:rotate(-30deg);}
            25%{transform:rotate(-12deg);}
            50%{transform:rotate(25deg);}
            75%{transform:rotate(-6deg);}
            100%{transform:rotate(-30deg);}
        }
        @keyframes walkLegLeft {
            0%{transform:rotate(35deg);}
            25%{transform:rotate(10deg);}
            50%{transform:rotate(-18deg);}
            75%{transform:rotate(22deg);}
            100%{transform:rotate(35deg);}
        }
        @keyframes walkLegRight {
            0%{transform:rotate(-22deg);}
            25%{transform:rotate(-8deg);}
            50%{transform:rotate(35deg);}
            75%{transform:rotate(0deg);}
            100%{transform:rotate(-22deg);}
        }
        /* --- Keyframes 뛰기 --- */
        @keyframes runJump {
            0%{transform:translateY(0);}
            20%{transform:translateY(-12px);}
            50%{transform:translateY(-22px);}
            80%{transform:translateY(-12px);}
            100%{transform:translateY(0);}
        }
        @keyframes runArmLeft {
            0%{transform:rotate(70deg);}
            40%{transform:rotate(-70deg);}
            50%{transform:rotate(-80deg);}
            60%{transform:rotate(-70deg);}
            100%{transform:rotate(70deg);}
        }
        @keyframes runArmRight {
            0%{transform:rotate(-80deg);}
            40%{transform:rotate(70deg);}
            50%{transform:rotate(80deg);}
            60%{transform:rotate(70deg);}
            100%{transform:rotate(-80deg);}
        }
        @keyframes runLegLeft {
            0%{transform:rotate(75deg);}
            30%{transform:rotate(-60deg);}
            50%{transform:rotate(-75deg);}
            80%{transform:rotate(72deg);}
            100%{transform:rotate(75deg);}
        }
        @keyframes runLegRight {
            0%{transform:rotate(-75deg);}
            30%{transform:rotate(60deg);}
            50%{transform:rotate(75deg);}
            80%{transform:rotate(-72deg);}
            100%{transform:rotate(-75deg);}
        }
        /* 나머지 UI */
        .interval-info{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;}
        .interval-card{background:rgba(255,255,255,0.15);border-radius:13px;padding:16px;text-align:center;}
        .interval-title{font-size:15px;opacity:0.8;margin-bottom:7px;}
        .interval-time{font-size:26px;font-weight:bold;}
        .controls{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;}
        .control-btn {border: none;border-radius: 12px; padding:17px;font-size:17px;font-weight:600;color:#fff;background:rgba(255,255,255,0.19);cursor:pointer;transition:all 0.3s;min-height:56px;}
        .control-btn.primary{background:#4CAF50;}
        .control-btn.danger{background:#f44336;}
        .control-btn.warning{background:#ff9800;}
        .control-btn:disabled{opacity:0.55;cursor:not-allowed;}
        /* 설정모달 */
        .settings-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.78);display:none;align-items:center;justify-content:center;z-index:1000;}
        .settings-content{background:#fff;border-radius:20px;padding:24px;width:320px;max-width:95vw;color:#333;}
        .settings-title{font-size:22px;font-weight:bold;margin-bottom:18px;text-align:center;}
        .setting-row{margin-bottom:18px;}
        .setting-label{font-weight:600;display:block;margin-bottom:7px;}
        .setting-input{width:100%;padding:10px;border:2px solid #ddd;border-radius:9px;font-size:16px;}
        .setting-buttons{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:24px;}
        .modal-btn{padding:13px;border:none;border-radius:9px;font-size:15px;font-weight:600;cursor:pointer;transition:all0.3s;}
        .modal-btn.save{background:#4CAF50;color:#fff;}
        .modal-btn.cancel{background:#f44336;color:#fff;}
        @media(max-width:768px){
            .container{padding:10px;}
            .interval-info{grid-template-columns:1fr;}
            .controls{grid-template-columns:1fr;}
        }
    </style>
</head>
<body>
<div class="container">
  <div class="header">
    <div style="font-size:17px;font-weight:600;">전체시간: <span id="totalTimeDisplay">30분</span></div>
    <button class="settings-btn" onclick="openSettings()">⚙️</button>
  </div>
  <div class="phase-display">
    <div class="current-phase" id="currentPhase">준비</div>
    <div class="phase-time" id="phaseTime">00:00</div>
  </div>
  <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
  <div class="animation-container">
    <div class="stick-figure-outer" id="stickWrap">
      <div class="stick-figure" id="stickFigure">
        <div class="stick-head"></div>
        <div class="stick-body"></div>
        <div class="stick-arm left"></div>
        <div class="stick-arm right"></div>
        <div class="stick-leg left"></div>
        <div class="stick-leg right"></div>
      </div>
    </div>
  </div>
  <div class="interval-info">
    <div class="interval-card">
      <div class="interval-title">걷기</div>
      <div class="interval-time" id="walkTimeDisplay">2:00</div>
    </div>
    <div class="interval-card">
      <div class="interval-title">뛰기</div>
      <div class="interval-time" id="runTimeDisplay">2:00</div>
    </div>
  </div>
  <div class="controls">
    <button class="control-btn primary" id="startBtn" onclick="startWorkout()">시작</button>
    <button class="control-btn warning" id="pauseBtn" onclick="pauseWorkout()" disabled>일시정지</button>
    <button class="control-btn danger" id="stopBtn" onclick="stopWorkout()" disabled>정지</button>
    <button class="control-btn" id="nextBtn" onclick="nextPhase()" disabled>다음단계</button>
  </div>
</div>

<div class="settings-modal" id="settingsModal">
  <div class="settings-content">
    <div class="settings-title">운동 설정</div>
    <div class="setting-row">
      <label class="setting-label">전체 트레이닝 시간 (분)</label>
      <input type="number" class="setting-input" id="totalTimeInput" value="30" min="5" max="120">
    </div>
    <div class="setting-row">
      <label class="setting-label">워밍업 시간 (분)</label>
      <input type="number" class="setting-input" id="warmupTimeInput" value="10" min="0" max="20">
    </div>
    <div class="setting-row">
      <label class="setting-label">걷기 시간 (분)</label>
      <input type="number" class="setting-input" id="walkTimeInput" value="2" min="1" max="10">
    </div>
    <div class="setting-row">
      <label class="setting-label">뛰기 시간 (분)</label>
      <input type="number" class="setting-input" id="runTimeInput" value="2" min="1" max="10">
    </div>
    <div class="setting-buttons">
      <button class="modal-btn cancel" onclick="closeSettings()">취소</button>
      <button class="modal-btn save" onclick="saveSettings()">저장</button>
    </div>
  </div>
</div>
<script>
    let currentPhase = 'ready', remainingTime = 0;
    let totalTime = 30*60, warmupTime=10*60, walkTime=2*60, runTime=2*60;
    let isPaused=false, isRunning=false, timer=null, currentCycle=1, totalCycles=1;
    const el = {
      currentPhase: document.getElementById('currentPhase'),
      phaseTime: document.getElementById('phaseTime'),
      progressFill: document.getElementById('progressFill'),
      stickWrap: document.getElementById('stickWrap'),
      stickFigure: document.getElementById('stickFigure'),
      startBtn: document.getElementById('startBtn'),
      pauseBtn: document.getElementById('pauseBtn'),
      stopBtn: document.getElementById('stopBtn'),
      nextBtn: document.getElementById('nextBtn'),
      walkTimeDisplay: document.getElementById('walkTimeDisplay'),
      runTimeDisplay: document.getElementById('runTimeDisplay'),
      totalTimeDisplay: document.getElementById('totalTimeDisplay')
    };
    function init(){
      updateDisplay();calculateCycles();updateTimeDisplays();
    }
    function calculateCycles(){
      const intervalTime = walkTime+runTime;
      const availableTime=totalTime-warmupTime;
      totalCycles = Math.floor(availableTime/intervalTime);
    }
    function formatTime(sec){const m=Math.floor(sec/60),s=sec%60; return `${m}:${s.toString().padStart(2,'0')}`;}
    function updateDisplay(){
      el.phaseTime.textContent=formatTime(remainingTime);
      let progress=0,totSecs=totalTime,elapsed=totSecs-remainingTime;
      if(currentPhase==='ready')progress=0;
      else {
          // 실제 진행률 보정
          const mainPhases = warmupTime+totalCycles*(walkTime+runTime);
          const doneTime = (currentPhase==='warmup'?0:
              (currentCycle-1)*(walkTime+runTime)+
              (currentPhase==='walking'?walkTime-remainingTime:walkTime)+
              (currentPhase==='running'?runTime-remainingTime:0));
          progress = 100*(doneTime+warmupTime)/mainPhases;
      }
      el.progressFill.style.width=`${Math.min(progress,100)}%`;
    }
    function updateTimeDisplays(){
      el.walkTimeDisplay.textContent=formatTime(walkTime);
      el.runTimeDisplay.textContent=formatTime(runTime);
      el.totalTimeDisplay.textContent=`${Math.floor(totalTime/60)}분`;
    }
    function setAnimation(type){
      // reset
      el.stickWrap.className='stick-figure-outer';
      el.stickFigure.className='stick-figure';
      if(type==='walking'){el.stickWrap.classList.add('walking');}
      else if(type==='running'){el.stickWrap.classList.add('running');}
    }
    function changePhase(newPhase,time){
      currentPhase=newPhase; remainingTime=time;
      switch(newPhase){
        case 'warmup': el.currentPhase.textContent=`워밍업 (${currentCycle}/${totalCycles})`; setAnimation('walking');break;
        case 'walking': el.currentPhase.textContent=`걷기 (${currentCycle}/${totalCycles})`; setAnimation('walking');break;
        case 'running': el.currentPhase.textContent=`뛰기 (${currentCycle}/${totalCycles})`; setAnimation('running');break;
        case 'completed':el.currentPhase.textContent='완료!'; setAnimation('');break;
        default: el.currentPhase.textContent='준비'; setAnimation('');
      }
      updateDisplay();
      // 음성 안내
      if(window.speechSynthesis){
          try{
              const utter=new SpeechSynthesisUtterance(el.currentPhase.textContent);
              utter.lang='ko-KR';utter.volume=0.5;speechSynthesis.speak(utter);
          }catch(e){}
      }
      // 햅틱 피드백
      if(navigator.vibrate){
        if(newPhase==='running') navigator.vibrate([190,100,190]);
        else if(newPhase==='walking') navigator.vibrate(100);
      }
    }
    function startWorkout(){
      isRunning=true;isPaused=false;currentCycle=1;
      changePhase('warmup',warmupTime);
      el.startBtn.disabled=true;el.pauseBtn.disabled=false;el.stopBtn.disabled=false;el.nextBtn.disabled=false;
      startTimer();
    }
    function startTimer(){
      if(timer)clearInterval(timer);
      timer=setInterval(()=>{
        if(!isPaused&&isRunning){
          remainingTime--;updateDisplay();
          if(remainingTime<=0){nextPhase();}
        }
      },1000);
    }
    function nextPhase(){
      switch(currentPhase){
        case 'warmup':changePhase('walking',walkTime);break;
        case 'walking':changePhase('running',runTime);break;
        case 'running':
          if(currentCycle<totalCycles){currentCycle++;changePhase('walking',walkTime);}
          else{changePhase('completed',0);stopWorkout();}
          break;
      }
    }
    function pauseWorkout(){
      isPaused=!isPaused;
      el.pauseBtn.textContent=isPaused?'재개':'일시정지';
      el.pauseBtn.className=isPaused?'control-btn primary':'control-btn warning';
    }
    function stopWorkout(){
      isRunning=false;isPaused=false;
      if(timer){clearInterval(timer);timer=null;}
      currentPhase='ready';remainingTime=0;currentCycle=1;
      el.currentPhase.textContent='준비';el.phaseTime.textContent='00:00';el.progressFill.style.width='0%';setAnimation('');
      el.startBtn.disabled=false;el.pauseBtn.disabled=true;el.stopBtn.disabled=true;el.nextBtn.disabled=true;
      el.pauseBtn.textContent='일시정지';el.pauseBtn.className='control-btn warning';
    }
    function openSettings(){
      document.getElementById('settingsModal').style.display='flex';
      document.getElementById('totalTimeInput').value=totalTime/60;
      document.getElementById('warmupTimeInput').value=warmupTime/60;
      document.getElementById('walkTimeInput').value=walkTime/60;
      document.getElementById('runTimeInput').value=runTime/60;
    }
    function closeSettings(){
      document.getElementById('settingsModal').style.display='none';
    }
    function saveSettings(){
      totalTime=parseInt(document.getElementById('totalTimeInput').value)*60;
      warmupTime=parseInt(document.getElementById('warmupTimeInput').value)*60;
      walkTime=parseInt(document.getElementById('walkTimeInput').value)*60;
      runTime=parseInt(document.getElementById('runTimeInput').value)*60;
      calculateCycles();updateTimeDisplays();closeSettings();
      if(isRunning) stopWorkout();
    }
    window.addEventListener('load',init);
    // 백그라운드 처리
    document.addEventListener('visibilitychange',()=>{
      if(document.hidden&&isRunning&&!isPaused){localStorage.setItem('backgroundTime',Date.now());}
      else if(!document.hidden&&isRunning&&!isPaused){
        const t=localStorage.getItem('backgroundTime');
        if(t){const elapsed=Math.floor((Date.now()-parseInt(t))/1000);remainingTime=Math.max(0,remainingTime-elapsed);updateDisplay();localStorage.removeItem('backgroundTime');}
      }
    });
    document.addEventListener('touchstart',()=>{}, {passive:true});
    document.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});
</script>
</body>
</html>
